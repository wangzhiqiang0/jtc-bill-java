<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="uk.tw.jtc.dao.BillingDao">

    <resultMap id="billing" type="uk.tw.jtc.model.Billing">
        <result property="billingId" jdbcType="VARCHAR" column="billing_id" />
        <result property="customerId" jdbcType="VARCHAR" column="customer_id" />
        <result property="phoneUsed" jdbcType="INTEGER" column="phone_used" />
        <result property="smsUsed" jdbcType="INTEGER" column="sms_used" />
        <result property="phonePay" jdbcType="INTEGER" column="phone_pay" />
        <result property="smsPay" jdbcType="INTEGER" column="sms_pay" />
        <result property="first" jdbcType="BOOLEAN" column="first" />
        <result property="subscriptTime" jdbcType="TIMESTAMP" column="subscript_time" />
        <result property="lastUpdateTime" jdbcType="TIMESTAMP" column="last_update_time" />
        <association column="package_id" property="packageInfo" javaType="uk.tw.jtc.model.PackageInfo" select="uk.tw.jtc.dao.PackageReadingDao.getPackageById"></association>
    </resultMap>

    <select id="getBillByCustomerId" resultMap="billing">
        select * from jtc_bill where customer_id = #{customerId}
    </select>


    <insert id="createNewBill" parameterType="uk.tw.jtc.model.Billing">
        insert into
        jtc_bill(billing_id,customer_id,package_id,first,subscript_time,last_update_time)
        values
        (#{billing.billingId},#{billing.customerId},#{billing.packageInfo.packageId},true,now(),now());
    </insert>

    <select id="getBillingList" resultMap="billing">
        select * from jtc_bill
    </select>


    <update id="updateFistToFalse"  >
        update  jtc_bill set first = false ,last_update_time = now() where billing_id = #{billingId}
    </update>

    <update id="updatePhoneUsed" >
        update  jtc_bill set phone_used = #{phoneUsed} ,last_update_time = now() where billing_id = #{billingId}
    </update>

    <update id="updateSMSUsed" >
        update  jtc_bill set sms_used = #{smsUsed} ,last_update_time = now() where billing_id = #{billingId}
    </update>

    <update id="updatePhonePay" >
        update  jtc_bill set phone_pay = #{phonePay} ,last_update_time = now() where billing_id = #{billingId}
    </update>

    <update id="updateSMSPay" >
        update  jtc_bill set sms_pay = #{smsPay} ,last_update_time = now() where billing_id = #{billingId}
    </update>



</mapper>